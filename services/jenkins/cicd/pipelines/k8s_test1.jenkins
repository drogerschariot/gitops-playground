#!/usr/bin/env groovy

def label = "k8sagent-e2e"
def home = "/home/jenkins"
def workspace = "${home}/workspace/build-jenkins-operator"
def workdir = "${workspace}/src/github.com/jenkinsci/kubernetes-operator/"

podTemplate(label: label,
    containers: [
            containerTemplate(name: 'alpine', 
                image: 'alpine:3.11', 
                ttyEnabled: true, 
                command: 'cat',
                resourceLimitCpu : "500m",
                resourceLimitMemory: "1g",
                resourceRequestCpu: "250m",
                resourceRequestMemory: "500Mi"),
    ],
    ) 
{
    node(label) {
        stage('Run shell') {
            container('alpine') {
                sh 'echo "hello world"'
            }
        }
        stage('Sleep 60 Seconds') {
            container('alpine') {
                sh 'sleep 60'
            }
        }
        stage('test touch') {
            container('alpine') {
                sh 'ls -l'
                sh 'df -h'
                sh 'touch hello'
            }
        }
        stage('test ls') {
            container('alpine') {
                sh 'ls -l'
            }
        }
    }
}
